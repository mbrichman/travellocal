<% if notice %>
<p id="notice"><%= notice %></p>
<% end %>
<div class="row-fluid">
  <% if signed_in? && current_user == @user %>
      <%= @user.name.titleize %> <%= link_to 'Edit Profile', edit_user_path(@user), class: 'btn btn-small' %>
  <% end %>
</div>
<div class="row-fluid">
  <div class="span4 primary row-fluid">
    <h3>My Trips <%= link_to 'Add Trip', new_trip_path, class: 'btn' %> </h3>
    <%= link_to 'Ask for Recommendations', '#myModal', class: 'btn', :"data-target" => "#myModal", :"data-toggle" => "modal" %>





    <h3><%= my_name %>Reviews</h3>
    <ul>
      <% @user.reviews.each do |review| %>
      <li><%= link_to review.place.try(:name).try(:titleize), review %></i></li>
      <% end %>
    </ul>

    <h3><%= link_to 'My Network', users_path %></h3>

  </div>
  <div class="span4 primary row-fluid">

    <% if current_user == @user %>

    <h3>Recommendation Requests</h3>
    <ul>
      <% RecommendationRequest.where(:user_id => current_user.id).each do |request| %>
          <li>I asked for recommendations for a trip to <%= request.city.try(:name).try(:capitalize) %>
        <% end %>
      <% RecommendationRequest.where(:friend_id => current_user.id).each do |request| %>
          <li><%= link_to request.user.name.capitalize, request %> wants to go to <%= request.city.name.capitalize %>
        <% end %>
    </ul>

    <h3><%= my_name %>Friend's Reviews</h3>
      <ul>
        <% current_user.friends_reviews.each do |place| %>
        <li><%= link_to Place.find(place.first).name.titleize, Place.find(place.first) %> reviewed by
              <% place[1].each do |review| %>
              <%= link_to review.user.name.capitalize, review %>
            <% end %>
        </li>

        <% end %>
      </ul>

    <h3>Their Friend's Reviews</h3>
      <ul>
        <% @user.nth_level(3).each do |contact| %>
          <% contact.reviews.each do |review| %>
            <li><%= link_to contact.try(:name).try(:capitalize), contact %> reviewed <%= link_to review.place.name.titleize, review %></li>
          <% end %>
        <% end %>
      </ul>

    <h3>Upcoming Trips</h3>
      <ul>
        <% @user.trips.each do |trip| %>
          <li><%= link_to trip.try(:name).try(:titleize), trip %> starting on <%= trip.start_date.strftime('%A, %B %e %Y') %></li>
        <% end %>
      </ul>

    <h3>Friends' Favorites</h3>
      <%= form_tag favorites_path,class: 'navbar-search pull-left' , method: 'get' do %>
        <%= text_field_tag :search, nil, class: "search-query span3", placeholder: 'Search Favorites' %>
      <% end %>
      <br>
      <br>
      <br>
      <ul>
        <% @user.friends.each do |friend| %>
          <% unless friend.favorites.count == 0 %>
            <li><%= "#{friend.name.capitalize} likes:" %></li>
            <ul>
              <% friend.favorites.map {|fave| fave.place }.each do |place| %>
                <li><%= link_to place.name.titleize, place %> in <%= place.city.name.titleize %></li>
              <% end %>
            </ul>
          <% end %>
        <% end %>
      </ul>
  </div>
  <div class="span4 primary row-fluid">
    <h3><%= my_name %>Wishlist</h3>
    <ul>
      <% current_user.wishlists.each do |wish| %>
          <li><%= wish.place.name.titleize %> <%= link_to raw("<i class=\"icon-remove\"></i>"), wishlist_path(wish), method: 'delete' %></li>
        <% end %>
    </ul>
    <h3><%= my_name %>Favorites</h3>
    <ul>
      <% current_user.favorites.each do |favorite| %>
          <li><%= favorite.place.name.titleize %> <%= link_to raw("<i class=\"icon-remove\"></i>"), favorite_path(favorite), method: 'delete' %></li>
        <% end %>
    </ul>
  </div>
    <% end %>
</div>

<!-- Modal -->
  <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="myModalLabel">Request Recommendations</h3>
      </div>
      <div class="modal-body">
        <%= form_tag recommendation_requests_path do %>

        <div class="field">
          <%= label_tag :city_id, 'Where do you want to go?' %><br />
          <%= select_tag :city_id, options_from_collection_for_select(City.all, :id, :name) %>
      </div>
      <div class="field">
          <%= label_tag :description, 'Tell your friends what you\'re looking to do?' %><br />
          <%= text_area_tag :description %>
      </div>
        Who do you want to send this to?<br />
          <% current_user.friends.each do |friend|  %>
           <%= check_box_tag "friend_ids[]", friend.id %> <%= label_tag "friend_ids[]", friend.name.capitalize %><br>
          <% end %>
      <br>
      <div class="actions">
      </div>
          </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal">Close</button>
        <%= submit_tag 'Submit', class: "btn btn-primary" %>
      </div>
      <% end %>
    </div>

